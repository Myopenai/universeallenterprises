# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘  MAKEFILE - PROMPT-FABRIK                                                 â•‘
# â•‘  [.TTT T,.&T,,.T,,,.T.] TOGETHERSYSTEMS                                   â•‘
# â•‘                                                                           â•‘
# â•‘  Deterministische Build-Targets fÃ¼r 99.99% Systemhandlung                 â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: all docs clean verify dev staging prod install test help
.PHONY: init-db add-prompt add-formula add-mix generate preview
.PHONY: aider aider-local aider-groq auto-fix
.PHONY: tauri-dev tauri-build
.PHONY: factory factory-dev factory-prod factory-validate factory-deploy

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# KONFIGURATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SHELL := /bin/bash
ROOT := .
BUILD := docs_build
SCRIPTS := scripts
SYSTEM := system
REGISTRY := $(SYSTEM)/registry

# Tool-PrÃ¼fung
TOOLS := jq
CHECK_TOOLS = $(foreach t,$(TOOLS),$(if $(shell which $(t)),,$(warning Missing tool: $(t))))

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# HAUPT-TARGETS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## all: Build + Verify + Init-DB
all: init-db docs verify
	@echo "âœ… All done!"

## docs: Baue Dokumentation
docs:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@$(SCRIPTS)/build_docs.sh $(ROOT)

## fix: Auto-Fix Pipeline (Clean, Build, Hash, SW, Deploy)
fix:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@$(SCRIPTS)/auto_fix.sh $(ROOT)

## auto-fix: VollstÃ¤ndige Auto-Fix Pipeline (AI â†’ Analyzer â†’ Tests â†’ Commit)
auto-fix:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@$(SCRIPTS)/auto_fix_pipeline.sh $(ROOT)

## clean: LÃ¶sche Build-Artefakte
clean:
	@echo "ðŸ§¹ Cleaning..."
	@rm -rf $(BUILD)
	@rm -rf build_out
	@rm -rf node_modules/.cache 2>/dev/null || true
	@rm -rf logs/*.log 2>/dev/null || true
	@echo "âœ“ Clean"

## verify: PrÃ¼fe Links und Lint
verify:
	@echo "ðŸ” Verifying..."
	@if [ -f $(SCRIPTS)/validate_links.sh ]; then $(SCRIPTS)/validate_links.sh; fi
	@if [ -f $(SCRIPTS)/lint_md.sh ]; then $(SCRIPTS)/lint_md.sh; fi
	@echo "âœ“ Verify"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PROMPT-FABRIK TARGETS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## init-db: Initialisiere Prompt-Datenbank mit Starter-Rezepten
init-db: $(CHECK_TOOLS)
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@$(SCRIPTS)/prompt_db_init.sh $(ROOT)

## add-prompt: FÃ¼ge Prompt hinzu (ITEM=path/to/prompt.json)
add-prompt:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@jq '.prompts += [input]' $(REGISTRY)/prompt_db.json $(ITEM) > $(REGISTRY)/prompt_db.json.tmp
	@mv $(REGISTRY)/prompt_db.json.tmp $(REGISTRY)/prompt_db.json
	@echo "âœ“ Prompt hinzugefÃ¼gt: $(ITEM)"

## add-formula: FÃ¼ge Formel hinzu (ITEM=path/to/formula.json)
add-formula:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@jq '.formulas += [input]' $(REGISTRY)/prompt_db.json $(ITEM) > $(REGISTRY)/prompt_db.json.tmp
	@mv $(REGISTRY)/prompt_db.json.tmp $(REGISTRY)/prompt_db.json
	@echo "âœ“ Formel hinzugefÃ¼gt: $(ITEM)"

## add-mix: FÃ¼ge Mix hinzu (ITEM=path/to/mix.json)
add-mix:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@jq '.mixes += [input]' $(REGISTRY)/prompt_db.json $(ITEM) > $(REGISTRY)/prompt_db.json.tmp
	@mv $(REGISTRY)/prompt_db.json.tmp $(REGISTRY)/prompt_db.json
	@echo "âœ“ Mix hinzugefÃ¼gt: $(ITEM)"

## generate: Generiere Programm (OUT=output_dir ID=prompt_id)
generate:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@$(SCRIPTS)/program_generate.sh $(ROOT) $(OUT) $(ID)

## preview: Zeige Mix-Vorschau (MIX_ID=mix_id)
preview:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@$(SCRIPTS)/mix_preview.sh $(ROOT) $(MIX_ID)

## list-prompts: Liste alle verfÃ¼gbaren Prompts
list-prompts:
	@echo "ðŸ“‹ VerfÃ¼gbare Prompts:"
	@jq -r '.prompts[] | "  \(.id) - \(.title) [\(.language)/\(.framework)]"' $(REGISTRY)/prompt_db.json 2>/dev/null || echo "  (Datenbank nicht initialisiert - fÃ¼hre 'make init-db' aus)"

## list-formulas: Liste alle verfÃ¼gbaren Formeln
list-formulas:
	@echo "ðŸ”¬ VerfÃ¼gbare Formeln:"
	@jq -r '.formulas[] | "  \(.id) - \(.title) [\(.type)]"' $(REGISTRY)/prompt_db.json 2>/dev/null || echo "  (Datenbank nicht initialisiert)"

## list-mixes: Liste alle verfÃ¼gbaren Mixes
list-mixes:
	@echo "ðŸ”® VerfÃ¼gbare Mixes:"
	@jq -r '.mixes[] | "  \(.mixId) - \(.title)"' $(REGISTRY)/prompt_db.json 2>/dev/null || echo "  (Datenbank nicht initialisiert)"

## stats: Zeige Datenbank-Statistiken
stats:
	@echo "ðŸ“Š Prompt-DB Statistiken:"
	@jq '.stats' $(REGISTRY)/prompt_db.json 2>/dev/null || echo "  (Datenbank nicht initialisiert)"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# UMGEBUNGS-TARGETS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## dev: Starte Development Server
dev:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@$(SCRIPTS)/start.sh dev

## staging: Baue fÃ¼r Staging
staging:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@$(SCRIPTS)/start.sh staging

## prod: Baue und deploye zu Production
prod:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@$(SCRIPTS)/start.sh prod

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# INSTALLATION & TEST
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## install: Installiere Dependencies
install:
	@echo "ðŸ“¦ Installing dependencies..."
	@if [ -f package.json ]; then npm ci; fi
	@if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
	@pip install aider-chat 2>/dev/null || true
	@echo "âœ“ Dependencies installed"

## test: FÃ¼hre Tests aus
test:
	@echo "ðŸ§ª Running tests..."
	@if [ -f package.json ]; then npm test 2>/dev/null || true; fi
	@echo "âœ“ Tests complete"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# AIDER & CONTINUE.DEV
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## aider: Starte Aider
aider:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@$(SCRIPTS)/aider-start.sh

## aider-local: Starte Aider mit lokalem Modell (DeepSeek Coder)
aider-local:
	@aider --model ollama/deepseek-coder --config .aider.conf.yml

## aider-groq: Starte Aider mit Groq (LLaMA 3.1)
aider-groq:
	@aider --model groq/llama-3.1-70b-versatile --config .aider.conf.yml

## aider-openrouter: Starte Aider mit OpenRouter (DeepSeek)
aider-openrouter:
	@aider --model openrouter/deepseek/deepseek-coder --config .aider.conf.yml

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# TAURI/ELECTRON
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## tauri-dev: Starte Tauri Development
tauri-dev:
	@cd src-tauri && cargo tauri dev

## tauri-build: Baue Tauri App
tauri-build:
	@cd src-tauri && cargo tauri build

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# HILFE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ENCODING & MARKTWERT
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## encoding-check: PrÃ¼fe UTF-8 Encoding aller Dateien
encoding-check:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@$(SCRIPTS)/encoding_lint.sh $(ROOT) check

## encoding-fix: Repariere Encoding-Probleme
encoding-fix:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@$(SCRIPTS)/encoding_lint.sh $(ROOT) fix

## encoding-strict: Strenger Modus (bricht Build ab)
encoding-strict:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@$(SCRIPTS)/encoding_lint.sh $(ROOT) strict

## market-value: Berechne Marktwert-Teilhabe
market-value:
	@chmod +x $(SCRIPTS)/*.sh 2>/dev/null || true
	@$(SCRIPTS)/market_value_calculator.sh

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# HILFE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## help: Zeige diese Hilfe
help:
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘  [.TTT T,.&T,,.T,,,.T.] TOGETHERSYSTEMS - PROMPT-FABRIK                  â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "ðŸ­ Prompt-Fabrik:"
	@echo "  make init-db              # Initialisiere Datenbank"
	@echo "  make list-prompts         # Liste Prompts"
	@echo "  make list-formulas        # Liste Formeln"
	@echo "  make list-mixes           # Liste Mixes"
	@echo "  make generate OUT=dir ID=prompt_id  # Generiere Programm"
	@echo "  make preview MIX_ID=id    # Mix-Vorschau"
	@echo ""
	@echo "ðŸ”§ Build & Deploy:"
	@echo "  make dev                  # Development Server"
	@echo "  make fix                  # Auto-Fix (Build)"
	@echo "  make auto-fix             # VollstÃ¤ndige Pipeline"
	@echo "  make prod                 # Production Deploy"
	@echo ""
	@echo "ðŸ¤– AI-Assistenten:"
	@echo "  make aider                # Aider (default)"
	@echo "  make aider-local          # Aider + Ollama"
	@echo "  make aider-groq           # Aider + Groq"
	@echo ""
	@echo "ðŸ–¥ï¸  Desktop:"
	@echo "  make tauri-dev            # Tauri Development"
	@echo "  make tauri-build          # Tauri Build"
	@echo ""
	@echo "ðŸ­ Industrial Factory (A-Start):"
	@echo "  make factory              # VollstÃ¤ndiger Factory-Run"
	@echo "  make factory-dev          # Factory (Development)"
	@echo "  make factory-prod         # Factory (Production + Deploy)"
	@echo "  make factory-validate     # Nur Validierung"
	@echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# INDUSTRIAL FACTORY (A-START)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## factory: VollstÃ¤ndiger industrieller Factory-Run (A-Start aus Ordner)
factory:
	@echo "ðŸ­ Starting Industrial Software Factory..."
	@chmod +x bootstrap/*.sh 2>/dev/null || true
	@./bootstrap/start.sh --env dev

## factory-dev: Factory-Run fÃ¼r Development
factory-dev:
	@echo "ðŸ­ Starting Factory (Development)..."
	@chmod +x bootstrap/*.sh 2>/dev/null || true
	@./bootstrap/start.sh --env dev --debug

## factory-staging: Factory-Run fÃ¼r Staging
factory-staging:
	@echo "ðŸ­ Starting Factory (Staging)..."
	@chmod +x bootstrap/*.sh 2>/dev/null || true
	@./bootstrap/start.sh --env staging

## factory-prod: Factory-Run fÃ¼r Production mit Deploy
factory-prod:
	@echo "ðŸ­ Starting Factory (Production + Deploy)..."
	@chmod +x bootstrap/*.sh 2>/dev/null || true
	@./bootstrap/start.sh --env prod --deploy

## factory-validate: Nur Schema- und Policy-Validierung
factory-validate:
	@echo "ðŸ” Running Factory Validation..."
	@chmod +x bootstrap/*.sh 2>/dev/null || true
	@./bootstrap/validate_schemas.sh
	@./bootstrap/validate_policies.sh

## factory-deploy: Nur Deployment (ohne Build)
factory-deploy:
	@echo "ðŸš€ Running Factory Deployment..."
	@chmod +x scripts/*.sh 2>/dev/null || true
	@$(SCRIPTS)/deploy_github.sh 2>/dev/null || echo "  GitHub Pages: skipped"
	@$(SCRIPTS)/deploy_hostinger.sh 2>/dev/null || echo "  Hostinger: skipped"

## factory-sbom: Generiere Software Bill of Materials
factory-sbom:
	@echo "ðŸ“‹ Generating SBOM..."
	@mkdir -p sbom
	@if [ -f package.json ]; then \
		npx @cyclonedx/cyclonedx-npm --output-file sbom/sbom.json 2>/dev/null || \
		echo '{"bomFormat":"CycloneDX","specVersion":"1.5","version":1}' > sbom/sbom.json; \
	fi
	@echo "âœ“ SBOM generated: sbom/sbom.json"

## factory-audit: Generiere Audit-Report
factory-audit:
	@echo "ðŸ“Š Generating Audit Report..."
	@mkdir -p audit
	@echo "{\"timestamp\":\"$(shell date -Iseconds)\",\"project\":\"TogetherSystems\",\"status\":\"audited\"}" > audit/report-$(shell date +%Y%m%d).json
	@echo "âœ“ Audit report generated"
