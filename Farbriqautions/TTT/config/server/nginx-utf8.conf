# ╔═══════════════════════════════════════════════════════════════════════════╗
# ║  NGINX UTF-8 KONFIGURATION                                                ║
# ║  [.TTT T,.&T,,.T,,,.T.] TOGETHERSYSTEMS                                   ║
# ║                                                                           ║
# ║  Füge dies in deinen server {} Block ein                                  ║
# ╚═══════════════════════════════════════════════════════════════════════════╝

# ═══════════════════════════════════════════════════════════════════════════════
# UTF-8 CHARSET
# ═══════════════════════════════════════════════════════════════════════════════

charset utf-8;
charset_types text/html text/css application/javascript application/json text/xml text/plain;

# ═══════════════════════════════════════════════════════════════════════════════
# MIME TYPES MIT CHARSET
# ═══════════════════════════════════════════════════════════════════════════════

# HTML: Immer UTF-8, kein Cache
location ~* \.(html|htm)$ {
    add_header Content-Type "text/html; charset=utf-8";
    add_header Cache-Control "no-cache, no-store, must-revalidate";
    add_header Pragma "no-cache";
    add_header Expires "0";
}

# CSS: UTF-8, immutable Cache
location ~* \.css$ {
    add_header Content-Type "text/css; charset=utf-8";
    add_header Cache-Control "public, max-age=31536000, immutable";
}

# JavaScript: UTF-8, immutable Cache
location ~* \.js$ {
    add_header Content-Type "application/javascript; charset=utf-8";
    add_header Cache-Control "public, max-age=31536000, immutable";
}

# JSON: UTF-8
location ~* \.json$ {
    add_header Content-Type "application/json; charset=utf-8";
    add_header Cache-Control "public, max-age=31536000, immutable";
}

# ═══════════════════════════════════════════════════════════════════════════════
# STATISCHE ASSETS
# ═══════════════════════════════════════════════════════════════════════════════

# Bilder & Fonts: Immutable Cache
location ~* \.(png|jpg|jpeg|gif|ico|svg|webp|woff|woff2|ttf|eot)$ {
    add_header Cache-Control "public, max-age=31536000, immutable";
    access_log off;
}

# ═══════════════════════════════════════════════════════════════════════════════
# SICHERHEIT
# ═══════════════════════════════════════════════════════════════════════════════

# Verstecke sensible Dateien
location ~ /\. {
    deny all;
    access_log off;
    log_not_found off;
}

location ~* \.(yaml|yml|md|sh|sql|log)$ {
    deny all;
}

# Erlaube manifest.json und sw.js
location = /manifest.json {
    add_header Content-Type "application/json; charset=utf-8";
    add_header Cache-Control "public, max-age=86400";
}

location = /sw.js {
    add_header Content-Type "application/javascript; charset=utf-8";
    add_header Cache-Control "no-cache, no-store, must-revalidate";
}

# ═══════════════════════════════════════════════════════════════════════════════
# KOMPRESSION
# ═══════════════════════════════════════════════════════════════════════════════

gzip on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_types text/plain text/css text/xml application/json application/javascript 
           application/rss+xml application/atom+xml image/svg+xml;

# ═══════════════════════════════════════════════════════════════════════════════
# FEHLERSEITEN
# ═══════════════════════════════════════════════════════════════════════════════

error_page 404 /404.html;
error_page 500 502 503 504 /500.html;

