# ╔═══════════════════════════════════════════════════════════════════════════╗
# ║  TOGETHERSYSTEMS SECURITY POLICIES                                         ║
# ║  [.TTT T,.&T,,.T,,,.T.] © 2025 Raymond Demitrio Tel                       ║
# ╚═══════════════════════════════════════════════════════════════════════════╝

policy:
  name: "security"
  version: "1.0.0"
  description: "Security policies for TogetherSystems production"
  enforce: true

# ═══════════════════════════════════════════════════════════════════════════
# DEPENDENCY SCANNING
# ═══════════════════════════════════════════════════════════════════════════

dependencies:
  vulnerability_scan:
    enabled: true
    block_severity:
      - critical
      - high
    warn_severity:
      - medium
    ignore_severity:
      - low
    exceptions: []
    
  license_check:
    enabled: true
    allowed:
      - MIT
      - Apache-2.0
      - BSD-2-Clause
      - BSD-3-Clause
      - ISC
      - CC0-1.0
      - Unlicense
    blocked:
      - GPL-3.0
      - AGPL-3.0
    warn:
      - GPL-2.0
      - LGPL-3.0
    
  outdated_check:
    enabled: true
    max_age_days: 365
    block_on_violation: false

# ═══════════════════════════════════════════════════════════════════════════
# CODE SCANNING (SAST)
# ═══════════════════════════════════════════════════════════════════════════

static_analysis:
  enabled: true
  
  rules:
    # Secrets Detection
    - id: "SEC001"
      name: "hardcoded_secret"
      description: "Hardcoded secrets in source code"
      severity: "critical"
      block: true
      patterns:
        - "password\\s*=\\s*['\"][^'\"]+['\"]"
        - "api[_-]?key\\s*=\\s*['\"][^'\"]+['\"]"
        - "secret\\s*=\\s*['\"][^'\"]+['\"]"
        - "private[_-]?key\\s*=\\s*['\"][^'\"]+['\"]"
      exclude:
        - "*.example"
        - "*.template"
        - "ENV-EXAMPLE.txt"
    
    # SQL Injection
    - id: "SEC002"
      name: "sql_injection"
      description: "Potential SQL injection vulnerability"
      severity: "critical"
      block: true
      patterns:
        - "execute\\s*\\(.*\\+.*\\)"
        - "query\\s*\\(.*\\$\\{.*\\}.*\\)"
    
    # XSS
    - id: "SEC003"
      name: "xss_vulnerability"
      description: "Potential XSS vulnerability"
      severity: "high"
      block: true
      patterns:
        - "innerHTML\\s*="
        - "document\\.write\\s*\\("
        - "eval\\s*\\("
    
    # Insecure Protocols
    - id: "SEC004"
      name: "insecure_protocol"
      description: "Use of insecure protocols"
      severity: "medium"
      block: false
      patterns:
        - "http://"
        - "ftp://"
      exclude:
        - "localhost"
        - "127.0.0.1"

# ═══════════════════════════════════════════════════════════════════════════
# CONTAINER SECURITY
# ═══════════════════════════════════════════════════════════════════════════

containers:
  base_image:
    allowed_registries:
      - "docker.io"
      - "gcr.io"
      - "ghcr.io"
    blocked_tags:
      - "latest"
    require_digest: true
  
  runtime:
    run_as_root: false
    read_only_filesystem: true
    drop_capabilities:
      - ALL
    add_capabilities: []

# ═══════════════════════════════════════════════════════════════════════════
# HTTP SECURITY HEADERS
# ═══════════════════════════════════════════════════════════════════════════

headers:
  required:
    - name: "Content-Security-Policy"
      value: "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'"
    - name: "X-Content-Type-Options"
      value: "nosniff"
    - name: "X-Frame-Options"
      value: "SAMEORIGIN"
    - name: "X-XSS-Protection"
      value: "1; mode=block"
    - name: "Strict-Transport-Security"
      value: "max-age=31536000; includeSubDomains"
    - name: "Referrer-Policy"
      value: "strict-origin-when-cross-origin"

# ═══════════════════════════════════════════════════════════════════════════
# DATA PROTECTION
# ═══════════════════════════════════════════════════════════════════════════

data_protection:
  # No user data collection (OSOSOS principle)
  collect_user_data: false
  
  # Encryption
  encryption:
    at_rest: true
    in_transit: true
    algorithm: "AES-256"
  
  # Data retention
  retention:
    logs: "90d"
    audit: "365d"
    artifacts: "90d"

# ═══════════════════════════════════════════════════════════════════════════
# ACCESS CONTROL
# ═══════════════════════════════════════════════════════════════════════════

access_control:
  authentication:
    required: false  # Public portal
    methods: []
  
  authorization:
    roles:
      - name: "admin"
        permissions: ["read", "write", "deploy", "audit"]
      - name: "developer"
        permissions: ["read", "write"]
      - name: "viewer"
        permissions: ["read"]
  
  secrets:
    storage: "environment"
    rotation: "90d"
    encryption: true

# ═══════════════════════════════════════════════════════════════════════════
# COMPLIANCE
# ═══════════════════════════════════════════════════════════════════════════

compliance:
  gdpr:
    enabled: false  # No user data
  
  supply_chain:
    sbom_required: true
    provenance_required: true
    signed_artifacts: true

