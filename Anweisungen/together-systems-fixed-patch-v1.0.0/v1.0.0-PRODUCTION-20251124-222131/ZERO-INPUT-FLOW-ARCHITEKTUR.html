<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ZERO-INPUT-FLOW-ARCHITEKTUR</title>
<style>
body { font-family: system-ui; max-width: 800px; margin: 0 auto; padding: 20px; }
pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
code { background: #f5f5f5; padding: 2px 4px; border-radius: 3px; }
</style>
</head>
<body>
<h1>Zero-Input-Flow Architektur</h1>

<h2>ğŸ¯ Vision</h2>

<strong>Der User soll das System einfach "fahren" wie ein autonomes Fahrzeug.</strong>
- Nur kommunizieren, keine Konfiguration
- Keine Formular-HÃ¶lle
- Automatische Verbindungen, automatische RÃ¤ume, automatische Slots

---

<h2>ğŸ“‹ Phase 1: Presence-Auto-Init (SOFORT umsetzbar)</h2>

<h3>Ziel</h3>
Beim Laden von `manifest-portal.html`:
- âœ… Automatisch `/api/presence/verify` aufrufen (ohne User-Eingabe)
- âœ… `thinker_id` in `localStorage` speichern
- âœ… Auf jeder Seite: Alle X Sekunden `/api/presence/heartbeat` â†’ User ist "online"

<h3>Implementierung</h3>
Siehe `manifest-portal.html` - Funktion: `autoConnectFromToken()`

<strong>Status:</strong> âœ… Bereits teilweise implementiert, muss nur automatisch beim Seitenladen ausgefÃ¼hrt werden

---

<h2>ğŸ“‹ Phase 2: One-Click-Matching (NÃ„CHSTER SCHRITT)</h2>

<h3>Ziel</h3>
Statt manuell `pair_code` eintippen:
- âœ… `pair_code` kann fÃ¼r einen Kontakt/Link automatisch generiert werden
- âœ… In der URL stehen: `https://.../manifest-portal.html?room=ABCD`
- âœ… Der zweite Nutzer klickt auf den Link â†’ Frontend liest `room`-Param
- âœ… Ruft `/api/presence/verify` und `/match` automatisch

<strong>Ergebnis:</strong> Der User macht nur einen Link-Klick, keine Eingabe.

<h3>Implementierung</h3>
Siehe Code-Snippets unten

---

<h2>ğŸ“‹ Phase 3: Konversations-Start-Templates</h2>

<h3>Ziel</h3>
In `manifest-portal.html`:
- âœ… Statt langem Formular: Buttons wie "Call", "Chat", "Group Session"
- âœ… Dahinter werden intern:
  - Voucher/Slots (falls nÃ¶tig) erzeugt
  - Presence & WebSocket-Room angelegt
  - Telbank-Flows vorbereitet

<h3>Implementierung</h3>
Siehe Code-Snippets unten

---

<h2>ğŸ“‹ Phase 4: Voucher & Slots automatisch</h2>

<h3>Ziel</h3>
Der User klickt: "Call mit X planen"
- âœ… Frontend fragt `/api/slots/available` fÃ¼r X
- âœ… WÃ¤hlt automatisch den ersten passenden Slot
- âœ… Bucht den Slot via `/api/voucher/book`
- âœ… User sieht nur: "Termin am Dienstag, 14:00 steht â€“ Join-Button"

<strong>â†’ Keine Eingabe, nur BestÃ¤tigung</strong>

---

<h2>ğŸ“‹ Phase 5: Kontaktliste + Presence kombinieren</h2>

<h3>Ziel</h3>
Eine simple "Contact Card"-Liste anzeigen:
- âœ… FÃ¼r jeden Kontakt:
  - Status (online/offline) Ã¼ber Presence-API
  - "Join Conversation"-Button:
    - Triggert intern `pair_code`-Generierung + `/match` + WebSocket-Join

<strong>Der User klickt nur noch auf Personen, nicht auf technische Dinge.</strong>

---

<h2>ğŸ”§ Implementierungs-Details</h2>

<h3>Was im Code jetzt schon als Features drinsteckt</h3>

Aus dem Code kann man folgende (teilweise "versteckte") Features erkennen:

<h4>âœ… Presence / Matching</h4>
- `/api/presence/verify`, `/heartbeat`, `/match`, `/debug`
- Token + HMAC-Option, `thinker_id`, `pair_code`, `room_id`
- Matching-Logik, um zwei Leute mit gleichem `pair_code` in denselben Raum zu stecken

<h4>âœ… WebSocket-Livechat</h4>
- `functions/ws.js` â†’ `/ws`
- Rooms, Broadcast, basic Signaling â€“ vorbereitet fÃ¼r Live-Communication

<h4>âœ… Telbank</h4>
- Frontend: `TELBANK/index.html`, `TELBANK/telbank-app.js`
- Backend: `/api/telbank/transfers` (D1-Tabelle `transfers`)
- Event-Sourcing-Light Ã¼ber Tabelle `events`

<h4>âœ… Voucher & Slots</h4>
- Backend: `/api/voucher/issue`, `/book`, `/cancel`, `/bookings`
- Noch eine API `/api/slots/available`
- Kann man nutzen fÃ¼r Zeit-Slots, Sessions, GesprÃ¤che, etc.

<h4>âœ… Mortgage-Flow</h4>
- `/api/mortgage/application`, `/offer`, `/offer-list`
- D1-Tabellen `mortgage_applications`, `mortgage_offers`, `mortgage_contracts`

<h4>âœ… Contracts & Upload</h4>
- `/api/contracts/upload`, `/list`
- Integration mit D1, optional R2 (derzeit nicht aktiv)

<h4>âœ… Telemetry & Autofix</h4>
- `/api/telemetry` mit `TS_API_KEY` und Rate Limits
- `/api/autofix/errors`, `/status`, `/notify`
- `autofix-client.js` integrierbar in jede Seite:
  - Fehler werden gesammelt
  - Backendseitig analysiert
  - Benutzer bekommt hÃ¼bsche Notifs ("Fix vorgeschlagen")

<h4>âœ… Admin-Monitoring, Honeycomb, Ambient Media</h4>
- `admin-monitoring.html`, `business-admin.html`, `honeycomb.html`, `ambient-media.js`
- Visualisierung von Events, RÃ¤umen, Traffic, etc.

<strong>Das ist keine Dummy-Doku â€“ das ist echte, greifbare FunktionalitÃ¤t im Code.</strong>

---

<h2>ğŸš€ Roadmap (3â€“5 Phasen)</h2>

<h3>Phase 1: Presence-Auto-Init âœ… (SOFORT)</h3>
- [x] Automatische `thinker_id`-Generierung beim Seitenladen
- [x] Automatischer Heartbeat alle X Sekunden
- [ ] Auto-Verifizierung ohne Token (optional)

<h3>Phase 2: One-Click-Match ğŸ”„ (NÃ„CHSTER SCHRITT)</h3>
- [ ] URL-Parameter `?room=ABCD` lesen
- [ ] Automatisch `pair_code` aus URL generieren
- [ ] Automatisch `/api/presence/match` aufrufen
- [ ] Automatisch WebSocket-Room joinen

<h3>Phase 3: Konversations-Templates ğŸ“…</h3>
- [ ] "Call", "Chat", "Group Session" Buttons
- [ ] Automatische Voucher/Slot-Erzeugung
- [ ] Automatischer WebSocket-Room-Aufbau

<h3>Phase 4: Auto-Slots ğŸ“…</h3>
- [ ] Automatische Slot-Auswahl
- [ ] Automatische Buchung
- [ ] BestÃ¤tigungs-UI

<h3>Phase 5: Kontaktliste ğŸ“…</h3>
- [ ] Presence-Status pro Kontakt
- [ ] "Join Conversation" Button
- [ ] Automatischer Match + WebSocket-Join

---

<h2>ğŸ“ NÃ¤chste Schritte</h2>

1. âœ… Code-Snippets fÃ¼r Presence-Auto-Init + One-Click-Match implementieren
2. âœ… In `manifest-portal.html` integrieren
3. âœ… Testen
4. â­ Phase 3-5 nach und nach umsetzen
</body>
</html>